\chapter{Hierarchical Model}
\label{cha:Hierachiemodell}
The hierarchical model describes different qualities of information coupling, based on service groups and serves as a recommendation concerning possible stages of implementation.
To realize a coupling between VRS and TIS, at least service 1 (static data) of both interacting parties has to be supported. In \cref{fig:depend}, dependencies between different services are depicted.

\begin{figure}[h]
  \centering
  \resizebox {\columnwidth} {!} {
  \begin{tikzpicture}
  % Dienste
  \tikzstyle{ann} = [draw=none,fill=none,right]
  \node[rectangleTX](s1) {Dienst 1\\Static data};
  \node[rectangleTX, below left of=s1](s3) {Service 3\\Availability Subscription};
  \node[rectangleTX, left= 1cm of s3](s2) {Service 2\\Availability Query};
  \node[rectangleTX, below right of=s1](s4) {Service 4\\Booking};
  \node[rectangleTX, right= 1cm of s4](s6) {Service 6\\Price Information};
  \node[rectangleTX, right= 1cm of s6](s9) {Service 9\\User Management};


  \node[rectangleTX, below left = 1cm of s4](s8) {Service 8\\Booking status\\(vehicle unlock)};
  \node[rectangleTX, left= 1cm of s8](s7) {Service 7\\Consumption data};
  \node[rectangleTX, left= 1cm of s7](s5) {Service 5\\Booking Subscription};
  \node[rectangleTX, right= 1cm of s8](s10) {Service 10\\Vehicle Settings};
  \node[rectangleTX, right= 1cm of s10](s11) {Service 11\\Navigation and Assistance};
  %   arrows
  \draw (s2) edge[->,thick=1cm] (s1);
  \draw (s3) edge[->,thick=1cm] (s1);
  \draw (s4) edge[->,thick=1cm] (s1);
  \draw (s5) edge[->,thick=1cm] (s4);
  \draw (s6) edge[->,thick=1cm] (s1);
  \draw (s7) edge[->,thick=1cm] (s4);
  \draw (s8) edge[->,thick=1cm] (s4);
  \draw (s9) edge[->,thick=1cm] (s1);
  \draw (s10) edge[->,thick=1cm] (s4);
  \draw (s11) edge[->,thick=1cm] (s4);
  \end{tikzpicture}
  }
  \caption{Service dependencies \label{fig:depend}}
\end{figure}


\section{Base Service A -- Session Handling}
\label{sec:Hierachiemodell:BasisdienstA}
Service A enables the authentication of end-customers towards the VRS.

\subsection*{Functions}
\begin{itemize}
\item Open / Close Session
\end{itemize}

\subsection*{Dependencies}
none

\section{Base Service B -- Subscription Handling}
\label{sec:Hierachiemodell:BasisdienstB}
Service B contains a function to check the status of a subscription connection (heartbeat)

\subsection*{Functions}
\begin{itemize}
\item Heartbeat
\end{itemize}

\subsection*{Dependencies}
none

\section{Base Service C -- tokens}
\label{sec:Hierachiemodell:BasisdienstC}
Service C contains a function to create authentication tokens for users, which can be saved/ transferred instead of plaintext passwords.

\subsection*{Functions}
\begin{itemize}
\item Creation of tokens
\end{itemize}

\subsection*{Dependencies}
none


\section{Service 1 -- Static Data}
\label{sec:Hierachiemodell:Dienst1}
Service 1 serves the information exchange across vehicle rental companies and static data of booking targets. These include provider-, position-, and vehicle-data. 

For example, service 1 can be used, to display messages solely for existing locations of an VRS-provider in a TIS. 
\subsection*{Functions}
\begin{itemize}
\item Call of booking targets and provider information.
\end{itemize}

\subsection*{Dependencies}
none

\section{Service 2 -- Availability Query}
\label{sec:Hierachiemodell:Dienst2}
Service 2 serves for asynchronous calls of availability information.

The actual availability times of booking targets are called during the travel inquiry by the TIS at the VRS.
\subsection*{Functions}
\begin{itemize}
\item Calls of availabilities of booking targets
\item Calls of location capacities (Service 2a)
\end{itemize}

\subsection*{Dependencies}
\begin{itemize}
\item Service 1
\end{itemize}

\section{Service 3 -- Availability Subscription}
\label{sec:Hierachiemodell:Dienst3}
Services 2 serves the asynchronous exchange of availability information.

To accelerate the travel inquiry, the TIS can subscribe availability timescales of booking targets to avoid a query during the travel inquiry. After subscribing for an amount of booking targets, the VRS informs continuously about changes in availability timescales. 

\subsection*{Functions}
\begin{itemize}
\item Availability subscription
\item Availability information (push)
\item Subscription of location capacities (Service 3a)
\end{itemize}

\subsection*{Dependencies}
\begin{itemize}
\item Service 1
\item Base Service B
\end{itemize}


\section{Service 4 -- Booking}
\label{sec:Hierachiemodell:Dienst4}
Service 4 serves booking, booking changes and canceling of vehicles via the TIS on behalf of the customer of a VRS.

The booking of a vehicle requires that a customer authenticates himself towards the VRS. Therefore, authentication information is forwarded from the TIS to the VRS. The secret (Password, key, etc.) of the customer is not allowed to be saved due to security reasons. The TIS receives an authentication-token in case of a successful authentication of a user. It can either be saved on the TIS or the user's device. Using the authentication-token, the TIS can proceed queries concerning bookings and canceling. 
To allow booking changes, a booking can be replaced by another booking via a booking change request. In case of an impossible booking, is has to be secured that the initial booking retains it's validity. 

\subsection*{Functions}
\begin{itemize}
\item Authentication of users towards the VHR 
\item Booking Query
\item Query concerning booking changes/ canceling
\end{itemize}

\subsection*{Dependencies}
\begin{itemize}
\item Service 1
\end{itemize}

\section{Service 5 -- Booking subscription}
\label{sec:Hierachiemodell:Dienst5}
Service 5 serves the subscription of booking changes.

The TIS is able to subscribe conducted bookings at the VRS to inform users in case of changes, e.g., damaged vehicles.
\subsection*{Functions}
\begin{itemize}
\item Booking subscriptions 
\item Booking alert (Push)
\end{itemize}

\subsection*{Dependencies}
\begin{itemize}
\item Service 4
\item Base Service B
\end{itemize}

\section{Service 6 -- Price information}
\label{sec:Hierachiemodell:Dienst6}
Service 6 serves price information of rental services.

Through the transmission of starting and target location as well as departure and arrival time of the travel, the TIS is able to query price information at the VRS to inform the user. The VRS responds with an overall price and eventually individual price parts.

\subsection*{Functions}
\begin{itemize}
\item Query of Prices
\end{itemize}

\subsection*{Dependencies}
\begin{itemize}
\item Service 1
\end{itemize}


\section{Dienst 7 -- Abonnement Verbrauchsdaten / Abrechnung (consumption data)}
Dienst 7 dient dem Austausch von Verbrauchsdaten wie z.\,B. Nutzungsdauer und Entfernung. Durch die Übermittlung der Verbrauchsdaten kann das RIS Rechnungen für Endkunden erstellen. Das RIS abonniert hierzu die Verbrauchsdaten einer durchgeführten Buchung beim FVS und erhält dann automatisch die zu dieser Buchung gehörigen Verbrauchsdaten.

\subsection*{Funktionen}
\begin{itemize}
\item Abonnement Verbrauchsdaten
\item Austausch Verbrauchsdaten (Push)
\end{itemize}

\subsection*{Abhängigkeiten}
\begin{itemize}
\item Dienst 4
%\ item Basisdienst A
\item Basisdienst B
\end{itemize}

\section{Dienst 8 -- Buchungsstatus ändern (freischalten / pausieren / abschließen) (booking state change)}
Dienst 8 dient dem Freischalten von Buchungen respektive Fahrzeugen (ggfs. Schlüsselkasten) durch das RIS. Dies erlaubt sowohl die Öffnung bzw. Freischaltung als auch die Rückgabe das Fahrzeug innerhalb der Endanwenderanwendung des RIS, z.\,B. innerhalb einer mobilen App. Weiterhin kann eine Buchung pausiert werden, dies schließt dass Fahrzeug physikalisch ab, beendet aber nicht die Buchung.
Der Status bezieht sich immer auf eine vorausgegangene Buchung und eine Authentifizierung ist erforderlich.

\subsection*{Funktionen}
\begin{itemize}
\item Buchung freischalten
\item Buchung pausieren
\item Buchung abschließen
\end{itemize}

\subsection*{Abhängigkeiten}
\begin{itemize}
\item Dienst 4
\item Basisdienst A
\end{itemize}

\section{Dienst 9 -- Anlegen und Sperren von Nutzern (user management)}
Dienst 9 dient dem Anlegen und Sperren von FVS Nutzern durch das RIS. Dies erlaubt, dass sich Nutzer nur beim RIS Betreiber registrieren müssen und diese Registrierung auch für das FVS gilt.

\subsection*{Funktionen}
\begin{itemize}
\item Benutzer anlegen
\item Benutzer sperren
\end{itemize}

\subsection*{Abhängigkeiten}
\begin{itemize}
\item Dienst 1
\item Basisdienst A
\end{itemize}


\section{Dienst 10 -- Fahrzeug- bzw. Buchungseinstellungsmanagement (booking settings)}
Dienst 10 dient dem Management von Fahrzeugeinstellungen. Das RIS kann Fahrzeugeinstellungen (Temperatur der Klimaanlage, eingestellter Radiosender etc) an das FVS übertragen und Einstellung für bestehende Buchungen abonnieren.

\subsection*{Funktionen}
\begin{itemize}
\item Fahrzeugeinstellungen setzten
\item Fahrzeugeinstellungen abonnieren
\end{itemize}

\subsection*{Abhängigkeiten}
\begin{itemize}
\item Dienst 4
\item Basisdienst A
\end{itemize}

\section{Dienst 11 -- Fernkonfiguration Navigationssystem und Fahrtverlauf überwachen}
Dienst 11 dient der Integration des Fahrzeugnavigationssystems in eine intermodale Reise. Das RIS kann nach der Buchung dem Fahrzeug den Zielort übermitteln, so dass der Reisende den Ort nicht selbst eingeben muss. Zusätzlich kann das RIS den Fortschritt der Fahrt überwachen um ggfs. auf Verzögerungen zu reagieren.

\subsection*{Funktionen}
\begin{itemize}
\item Navigationsziel des Fahrzeugs setzten
\item Fahrtverlauf abonnieren
\end{itemize}

\subsection*{Abhängigkeiten}
\begin{itemize}
\item Dienst 4
\item Basisdienst A
\end{itemize}
