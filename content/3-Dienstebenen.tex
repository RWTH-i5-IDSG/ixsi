\chapter{Hierarchical Model}
\label{cha:Hierachiemodell}
The hierarchical model describes different qualities of information coupling, based on service groups and serves as a recommendation concerning possible stages of implementation.
To realize a coupling between VRS and TIS, at least service 1 (static data) of both interacting parties has to be supported. Dependencies between different services are depicted in \cref{fig:depend}.

\begin{figure}[h]
  \centering
  \resizebox {\columnwidth} {!} {
  \begin{tikzpicture}
  % Dienste
  \tikzstyle{ann} = [draw=none,fill=none,right]
  \node[rectangleTX](s1) {Service 1\\Static data};
  \node[rectangleTX, below left of=s1](s3) {Service 3\\Availability Subscription};
  \node[rectangleTX, left= 1cm of s3](s2) {Service 2\\Availability Query};
  \node[rectangleTX, below right of=s1](s4) {Service 4\\Booking};
  \node[rectangleTX, right= 1cm of s4](s6) {Service 6\\Price Information};
  \node[rectangleTX, right= 1cm of s6](s9) {Service 9\\User Management};


  \node[rectangleTX, below left = 1cm of s4](s8) {Service 8\\Booking status\\(vehicle unlock)};
  \node[rectangleTX, left= 1cm of s8](s7) {Service 7\\Consumption data};
  \node[rectangleTX, left= 1cm of s7](s5) {Service 5\\Booking Subscription};
  \node[rectangleTX, right= 1cm of s8](s10) {Service 10\\Vehicle Settings};
  \node[rectangleTX, right= 1cm of s10](s11) {Service 11\\Navigation and Assistance};
  %   arrows
  \draw (s2) edge[->,thick=1cm] (s1);
  \draw (s3) edge[->,thick=1cm] (s1);
  \draw (s4) edge[->,thick=1cm] (s1);
  \draw (s5) edge[->,thick=1cm] (s4);
  \draw (s6) edge[->,thick=1cm] (s1);
  \draw (s7) edge[->,thick=1cm] (s4);
  \draw (s8) edge[->,thick=1cm] (s4);
  \draw (s9) edge[->,thick=1cm] (s1);
  \draw (s10) edge[->,thick=1cm] (s4);
  \draw (s11) edge[->,thick=1cm] (s4);
  \end{tikzpicture}
  }
  \caption{Service Dependencies \label{fig:depend}}
\end{figure}


\section{Base Service A -- Session Handling}
\label{sec:Hierachiemodell:BasisdienstA}
Service A enables the authentication of end-customers towards the VRS.

\subsection*{Functions}
\begin{itemize}
\item Open / Close Session
\end{itemize}

\subsection*{Dependencies}
none

\section{Base Service B -- Subscription Handling}
\label{sec:Hierachiemodell:BasisdienstB}
Service B contains a function to check the status of a subscription connection (heartbeat)

\subsection*{Functions}
\begin{itemize}
\item Heartbeat
\end{itemize}

\subsection*{Dependencies}
none

\section{Base Service C -- Tokens}
\label{sec:Hierachiemodell:BasisdienstC}
Service C contains a function to create authentication tokens for users, which can be saved / transferred instead of plaintext passwords.

\subsection*{Functions}
\begin{itemize}
\item Creation of Tokens
\end{itemize}

\subsection*{Dependencies}
none


\section{Service 1 -- Static Data}
\label{sec:Hierachiemodell:Dienst1}
Service 1 serves the information exchange across vehicle rental companies and static data of booking targets. These include provider-, position- and vehicle-data.

For example, service 1 can be used, to display messages solely for existing locations of an VRS-provider in a TIS. 
\subsection*{Functions}
\begin{itemize}
\item Call of booking targets and provider information.
\end{itemize}

\subsection*{Dependencies}
none

\section{Service 2 -- Availability Query}
\label{sec:Hierachiemodell:Dienst2}
Service 2 serves for synchronous calls of availability information. The actual availability times of booking targets are called from the VRS during the travel inquiry through the TIS.

The actual availability times of booking targets are called during the travel inquiry by the TIS at the VRS.
\subsection*{Functions}
\begin{itemize}
\item Calls of availabilities of booking targets
\item Calls of location capacities (Service 2a)
\end{itemize}

\subsection*{Dependencies}
\begin{itemize}
\item Service 1
\end{itemize}

\section{Service 3 -- Availability Subscription}
\label{sec:Hierachiemodell:Dienst3}
Service 3 serves the asynchronous exchange of availability information.

To accelerate the travel inquiry, the TIS can subscribe availability timescales of booking targets to avoid a query during the travel inquiry. After subscribing for an amount of booking targets, the VRS informs continuously about changes in availability timescales. 

\subsection*{Functions}
\begin{itemize}
\item Availability subscription
\item Availability information (push)
\item Subscription of location capacities (Service 3a)
\end{itemize}

\subsection*{Dependencies}
\begin{itemize}
\item Service 1
\item Base Service B
\end{itemize}


\section{Service 4 -- Booking}
\label{sec:Hierachiemodell:Dienst4}
Service 4 serves booking, booking changes and canceling of vehicles via the TIS on behalf of the customer of a VRS.

The booking of a vehicle requires that a customer authenticates himself towards the VRS. Therefore, authentication information is forwarded from the TIS to the VRS. The secret (Password, key, etc.) of the customer is not allowed to be saved due to security reasons. The TIS receives an authentication-token in case of a successful authentication of a user. It can either be saved on the TIS or the user's device. Using the authentication-token, the TIS can proceed queries concerning bookings and canceling. 
To allow booking changes, a booking can be replaced by another booking via a booking change request. In case of a booking errors, it has to be ensured that the initial booking retains it's validity. 

\subsection*{Functions}
\begin{itemize}
\item Authentication of users towards the VHR 
\item Booking Query
\item Query concerning booking changes/ canceling
\item Subscription of external Bookings (Service 4a)
\end{itemize}

\subsection*{Dependencies}
\begin{itemize}
\item Service 1
\end{itemize}

\section{Service 5 -- Booking Subscription}
\label{sec:Hierachiemodell:Dienst5}
Service 5 serves the subscription of booking changes.

The TIS is able to subscribe conducted bookings at the VRS to inform users in case of changes, e.g., damaged vehicles.
\subsection*{Functions}
\begin{itemize}
\item Booking subscriptions 
\item Booking alert (Push)
\end{itemize}

\subsection*{Dependencies}
\begin{itemize}
\item Service 4
\item Base Service B
\end{itemize}

\section{Service 6 -- Price Information}
\label{sec:Hierachiemodell:Dienst6}
Service 6 serves the price information of rental services.

Through the transmission of starting- and target-location as well as departure- and arrival-time of the travel, the TIS is able to query price information at the VRS to inform the user. The VRS responds with an overall price and eventually individual price parts.

\subsection*{Functions}
\begin{itemize}
\item Query of Prices
\end{itemize}

\subsection*{Dependencies}
\begin{itemize}
\item Service 1
\end{itemize}


\section{Service 7 -- Subscription Consumption Data/ Billing}
Service 7 serves to exchange consumption data, e.g, usage duration and distance. Through the transmission of consumption data, the TIS is able to create bills for end-customers. Therefore, the TIS subscribes consumption data of an executed booking at the VRS and receives the corresponding consumption data automatically. 

\subsection*{Functions}
\begin{itemize}
\item Subscription consumption data 
\item Exchange consumption data (Push)
\end{itemize}

\subsection*{Dependencies}
\begin{itemize}
\item Service 4
%\ item Basisdienst A
\item Base service B
\end{itemize}

\section{Service 8 -- Booking State Change (Unlocking / Pausing / Finishing)}
Service 8 serves to unlock booking of respective vehicles (probably via key case) by the TIS. This allows to unlock as well as to return of the vehicle during the usage phase of the TIS, e.g. via a mobile application. Furthermore, a booking can be paused, which locks the vehicle physically without finishing the booking. 
The state always refers to a preceding booking and an authentication is required.  

\subsection*{Functions}
\begin{itemize}
\item Unlock booking
\item Pause booking 
\item Finish booking 
\end{itemize}

\subsection*{Dependencies}
\begin{itemize}
\item Service 4
\item Base service A
\end{itemize}

\section{Service 9 -- User Management}
Service 9 serves to create and lock of user accounts of the VRS through the TIS. Therefore, a user just has to register himself at the TIS operator. This registration is valid even for usage of the VRS.

\subsection*{Functions}
\begin{itemize}
\item Create user account
\item Lock user account
\end{itemize}

\subsection*{Dependencies}
\begin{itemize}
\item Service 1
\item Base service A
\end{itemize}


\section{Service 10 -- Vehicle or Booking Settings}
Service 10 serves the management of vehicle settings. The TIS is able to transfer vehicle settings (e.g., air condition temperature, preferred radio stations) to the VRS and subscribe to settings of existing bookings.

\subsection*{Functions}
\begin{itemize}
\item Set vehicle settings 
\item Subscribe to vehicle settings
\end{itemize}

\subsection*{Dependencies}
\begin{itemize}
\item Service 4
\item Base service A
\end{itemize}

\section{Service 11 -- Remote Configuration of Navigation System and Journey Progress Monitoring}
Service 11 serves the integration of the vehicle navigation system into an intermodal journey. The TIS is able to transfer the target location to the vehicle after the booking, so that the traveler does not need to enter the location by his self. Additionally, the TIS is able to monitor the progress of a journey, in order to react in case of delays.

\subsection*{Functions}
\begin{itemize}
\item Set navigation target of vehicle
\item Subscribe to route progress
\end{itemize}

\subsection*{Dependencies}
\begin{itemize}
\item Service 4
\item Base service A
\end{itemize}
